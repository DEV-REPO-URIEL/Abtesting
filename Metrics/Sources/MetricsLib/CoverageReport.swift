import Foundation

/// Represents a code coverage report generated by XCov (maps to the JSON report one to one).
public struct CoverageReport: Decodable {
  public var targets: [Target]
  public var coverage: Double

  public init(targets: [Target], coverage: Double) {
    self.targets = targets
    self.coverage = coverage
  }

  /// Creates a CoverageReport from a JSON file generated by XCov.
  public static func load(path: String) throws -> CoverageReport {
    let data = try Data(contentsOf: NSURL(fileURLWithPath: path) as URL)
    let decoder = JSONDecoder()
    return try decoder.decode(CoverageReport.self, from: data)
  }
}

/// An XCov target.
public struct Target: Decodable {
  public var name: String
  public var files: [File]
  public var coverage: Double

  public init(name: String, coverage: Double) {
    self.name = name
    self.coverage = coverage
    files = []
  }
}

/// An XCov file.
public struct File: Decodable {
  public var name: String
  public var coverage: Double
  public var type: String
  public var functions: [Function]
}

/// An XCov function.
public struct Function: Decodable {
  public var name: String
  public var coverage: Double
}
